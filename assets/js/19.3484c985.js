(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{411:function(a,s,e){"use strict";e.r(s);var l=e(2),t=Object(l.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"查看尝试登录失败的ip-次数降序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看尝试登录失败的ip-次数降序"}},[a._v("#")]),a._v(" 查看尝试登录失败的ip，次数降序")]),a._v(" "),s("p",[s("code",[a._v("lastb | awk '{print $3}' | sort | uniq -c | sort -nr")])]),a._v(" "),s("h2",{attrs:{id:"安装-fail2ban"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-fail2ban"}},[a._v("#")]),a._v(" 安装 fail2ban")]),a._v(" "),s("p",[s("code",[a._v("yum search fail2ban")])]),a._v(" "),s("p",[a._v("CentOS内置源并未包含fail2ban，需要先安装epel源（建议更换腾讯云 Epel 源）")]),a._v(" "),s("p",[s("code",[a._v("yum install -y epel-release")])]),a._v(" "),s("p",[s("code",[a._v("yum install -y fail2ban")])]),a._v(" "),s("h2",{attrs:{id:"fail2ban-设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail2ban-设置"}},[a._v("#")]),a._v(" fail2ban 设置")]),a._v(" "),s("div",{staticClass:"language-linux line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemctl enable  fail2ban.service\nsystemctl start   fail2ban.service\nsystemctl restart fail2ban.service\nsystemctl status  fail2ban.service\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h2",{attrs:{id:"fail2ban-目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail2ban-目录结构"}},[a._v("#")]),a._v(" fail2ban 目录结构")]),a._v(" "),s("div",{staticClass:"language-txt line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[a._v("/etc/fail2ban               # fail2ban 服务配置目录\n/var/log/fail2ban.log       # fail2ban 日志文件路径\n/etc/fail2ban/action.d      # 禁止动作目录，iptables、mail、firewall-cmd 等动作文件\n/etc/fail2ban/filter.d      # 过滤规则目录，过滤日志关键内容\n/etc/fail2ban/fail2ban.conf # fail2ban 配置文件，定义日志级别、日志、sock 文件位置等\n/etc/fail2ban/jail.conf     # fail2ban 防护配置文件\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"配置规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置规则"}},[a._v("#")]),a._v(" 配置规则")]),a._v(" "),s("p",[a._v("不建议在原配置更改，建议复制一份配置文件\n"),s("code",[a._v("cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local")])]),a._v(" "),s("ul",[s("li",[a._v("修改 jail.local 来覆盖 fail2ban 的一些默认规则")]),a._v(" "),s("li",[a._v("因为 .local 新文件里配置的内容会覆盖 .conf 文件里内容相同的值")])]),a._v(" "),s("h3",{attrs:{id:"配置文件参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件参数说明"}},[a._v("#")]),a._v(" 配置文件参数说明")]),a._v(" "),s("p",[s("code",[a._v("vim /etc/fail2ban/jail.local")])]),a._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[a._v("[DEFAULT]\nignoreip = 127.0.0.1 10.0.8.3 1.12.219.198\nmaxretry = 5\nfindtime = 1m\nbantime  = -1\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("ul",[s("li",[a._v("DEFAULT: 全局设置")]),a._v(" "),s("li",[a._v("ignoreip: IP白名单，fail2ban不会屏蔽白名单中的IP，空格、/或逗号分隔")]),a._v(" "),s("li",[a._v("maxretry: 尝试登陆失败的阈值")]),a._v(" "),s("li",[a._v("findtime: maxretry 更新的时间间隔")]),a._v(" "),s("li",[a._v("bantime: 被禁秒数，-1永久")]),a._v(" "),s("li",[a._v("banaction: 屏蔽IP所使用的方法，例如使用firewalld屏蔽端口")]),a._v(" "),s("li",[a._v("action: 执行的动作，如发送e-mail")]),a._v(" "),s("li",[a._v("backend: 指定用于获取文件修改的后端。如果您使用的是 CentOS 或 Fedora，则需要将后端设置为 systemd。 对于其他操作系统，默认值 auto 就足够了。")])]),a._v(" "),s("h3",{attrs:{id:"ssh防止暴力破解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssh防止暴力破解"}},[a._v("#")]),a._v(" SSH防止暴力破解")]),a._v(" "),s("div",{staticClass:"language-markdown line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-markdown"}},[s("code",[a._v("[sshd]\nenabled = true\nfilter  = sshd\nport    = ssh\nlogpath = /var/log/secure\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("ul",[s("li",[a._v("sshd: 名称随意")]),a._v(" "),s("li",[a._v("filter: 过滤规则名称，必须填写位于 filter.d 目录里面的规则，sshd是fail2ban内置规则")]),a._v(" "),s("li",[a._v("port: 使用sshd服务默认的 22 端口号")]),a._v(" "),s("li",[a._v("logpath: 需要监视的日志路径")])]),a._v(" "),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[a._v("#")]),a._v(" 常用命令")]),a._v(" "),s("ul",[s("li",[a._v("重载fail2ban服务的配置："),s("code",[a._v("fail2ban-client reload")])]),a._v(" "),s("li",[a._v("查看fail2ban服务的状态："),s("code",[a._v("fail2ban-client status")])]),a._v(" "),s("li",[a._v("查看fail2ban服务对SSH的状态："),s("code",[a._v("fail2ban-client status sshd")])]),a._v(" "),s("li",[a._v("IP封禁："),s("code",[a._v("fail2ban-client set sshd banip IP_ADDRESS")])]),a._v(" "),s("li",[a._v("IP解禁："),s("code",[a._v("fail2ban-client set sshd unbanip IP_ADDRESS")])]),a._v(" "),s("li",[a._v("获取当前日志的等级："),s("code",[a._v("fail2ban-client get loglevel")])]),a._v(" "),s("li",[a._v("设置当前日志的等级："),s("code",[a._v("fail2ban-client set loglevel LOG_LEVEL")])]),a._v(" "),s("li",[a._v("默认 INFO，还有 CRITICAL, ERROR, WARNING, NOTICE, INFO, DEBUG")])]),a._v(" "),s("h3",{attrs:{id:"fail2ban正则匹配测试工具-验证规则对日志的匹配性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail2ban正则匹配测试工具-验证规则对日志的匹配性"}},[a._v("#")]),a._v(" fail2ban正则匹配测试工具（验证规则对日志的匹配性）")]),a._v(" "),s("p",[s("code",[a._v("fail2ban-regex /var/log/secure /etc/fail2ban/filter.d/sshd.conf --help")])]),a._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/2072020",target:"_blank",rel:"noopener noreferrer"}},[a._v("CentOS 7安装fail2ban + Firewalld防止爆破与CC攻击"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.cheshirex.com/1979.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("centos7服务器安装fail2ban配合Firewalld防护墙防止SSH爆破与防护网站CC攻击"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=t.exports}}]);